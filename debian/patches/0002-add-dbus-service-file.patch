From: =?utf-8?q?Guido=20G=C3=BCnther?= <agx@sigxcpu.org>
Date: Tue, 24 Mar 2009 00:47:10 +0100
Subject: [PATCH] add dbus service file

---
 src/Makefile.am                        |   12 ++++++++++--
 src/org.gnome.KrbAuthDialog.service.in |    3 +++
 2 files changed, 13 insertions(+), 2 deletions(-)
 create mode 100644 src/org.gnome.KrbAuthDialog.service.in

diff --git a/src/Makefile.am b/src/Makefile.am
index a0db9ec..1c74c84 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -12,11 +12,18 @@ autostart_DATA = $(autostart_in_files:.desktop.in=.desktop)
 
 schemadir = $(sysconfdir)/gconf/schemas
 schema_in_files = $(PACKAGE).schemas.in
-schema_DATA = $(PACKAGE).schemas
+schema_DATA = $(schema_in_files:.schemas.in=.schemas)
 
 %.schemas: $(srcdir)/%.schemas.in
 	sed -e "s,::PACKAGE::,$(PACKAGE)," < $< > $@
 
+servicedir       = $(datadir)/dbus-1/services
+service_in_files = org.gnome.KrbAuthDialog.service.in
+service_DATA     = $(service_in_files:.service.in=.service)
+
+$(service_DATA): $(service_in_files) Makefile
+	sed -e "s|\@BINDIR\@|$(bindir)|" $< > $@
+
 krb5_auth_dialog_SOURCES =	\
 	krb5-auth-dialog.c      \
 	krb5-auth-dialog.h      \
@@ -60,9 +67,10 @@ EXTRA_DIST =		\
 	$(pkgdata_DATA)   \
 	$(schema_in_files) \
 	$(autostart_in_files) \
+        $(service_in_files) \
 	krb5-auth-dialog.1.in
 
-CLEANFILES = $(schema_DATA)
+CLEANFILES = $(schema_DATA) $(service_DATA)
 DISTCLEANFILES = \
 	krb5-auth-dialog.desktop 	\
 	krb5-auth-applet-dbus-glue.h
diff --git a/src/org.gnome.KrbAuthDialog.service.in b/src/org.gnome.KrbAuthDialog.service.in
new file mode 100644
index 0000000..f49546a
--- /dev/null
+++ b/src/org.gnome.KrbAuthDialog.service.in
@@ -0,0 +1,3 @@
+[D-BUS Service]
+Name=org.gnome.KrbAuthDialog
+Exec=@BINDIR@/krb5-auth-dialog -A
-- 
