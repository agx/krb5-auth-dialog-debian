From: =?utf-8?q?Guido_G=C3=BCnther?= <agx@sigxcpu.org>
Date: Mon, 20 Oct 2014 10:31:16 +0200
Subject: Use current user name to determine principal

This got broken when switching from GConf to GSettings.

Closes: #762906
---
 src/ka-kerberos.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/ka-kerberos.c b/src/ka-kerberos.c
index 2b0106e..d3559b6 100644
--- a/src/ka-kerberos.c
+++ b/src/ka-kerberos.c
@@ -649,6 +649,10 @@ ka_parse_name (KaApplet *applet, krb5_context krbcontext,
         krb5_free_principal (krbcontext, *kprinc);
 
     g_object_get (applet, KA_PROP_NAME_PRINCIPAL, &principal, NULL);
+    if (principal[0] == '\0') {
+        g_free (principal);
+        principal = g_strdup (g_get_user_name());
+    }
     ret = krb5_parse_name (krbcontext, principal, kprinc);
 
     g_free (principal);
