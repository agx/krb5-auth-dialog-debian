From: Petter Reinholdtsen <pere@hungry.com>
Date: Thu, 4 Jul 2013 09:32:18 +0200
Subject: krb5_principal_compare crashes on NULL arguments

Debian Bug #714825
---
 src/ka-kerberos.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/ka-kerberos.c b/src/ka-kerberos.c
index db5cddd..0867234 100644
--- a/src/ka-kerberos.c
+++ b/src/ka-kerberos.c
@@ -221,8 +221,10 @@ credentials_expiring_real (KaApplet *applet)
     }
 
     /* copy principal from cache if any */
-    if (krb5_principal_compare (kcontext, my_creds.client, kprincipal)) {
-        krb5_free_principal (kcontext, kprincipal);
+    if (kprincipal == NULL ||
+        krb5_principal_compare (kcontext, my_creds.client, kprincipal)) {
+        if (kprincipal)
+            krb5_free_principal (kcontext, kprincipal);
         krb5_copy_principal (kcontext, my_creds.client, &kprincipal);
     }
     creds_expiry = my_creds.times.endtime;
